function t(t){t=t||Object.create(null);var n={on:function(n,e){(t[n]||(t[n]=[])).push(e)},off:function(n,e){t[n]&&(1==arguments.length?t[n]=[]:t[n].splice(t[n].indexOf(e)>>>0,1))},emit:function(n,e,o){void 0===e&&(e=[]);var i=(t[n]||[]).slice().map(function(t){return t.apply(o,e)}),a=(t["*"]||[]).slice().map(function(t){return t.apply(o,[].concat(e,[n]))});return[].concat(i,a)},asyncEmit:function(t,e,o){return void 0===e&&(e=[]),Promise.all(n.emit(t,e,o))}};return n}var n,e="object"==typeof wx&&"function"==typeof wx.getSystemInfoSync,o="object"==typeof my&&"function"==typeof my.getSystemInfoSync;e?n={App:["onLaunch","onShow","onHide","onError","onPageNotFound","onUnhandledRejection","onThemeChange"],Page:["onLoad","onShow","onBack","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onShareTimeline","onAddToFavorites","onPageScroll","onResize","onTabItemTap"],Component:["created","attached","ready","moved","detached"]}:o&&(n={App:["onLaunch","onShow","onHide","onError","onShareAppMessage"],Page:["onLoad","onShow","onBack","onReady","onHide","onUnload","onTitleClick","onPullDownRefresh","onReachBottom","onShareAppMessage","onOptionMenuClick","onPullIntercept","onTabItemTap","onPageScroll"],Component:["onInit","deriveDataFromProps","didMount","didUpdate","didUnmount"]});var i=n,a=t();Object.entries||(Object.entries=function(t){for(var n=Object.keys(t),e=n.length,o=new Array(e);e--;)o[e]=[n[e],t[n[e]]];return o});var r=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},s=function(t){return t&&"object"==r(t)&&"__type__"in t&&"Page"==t.__type__},c=function(t){return t&&"object"==r(t)&&!s(t)&&t.is},u=function(t){return t==getApp()};Object.assign(a,{type:r,isPage:s,isComponent:c,isApp:u,isMy:o,isWx:e,getPage:function(){var t=getCurrentPages();return t[t.length-1]},Event:t,version:"2.1.0"});var f=function(t,n){a.emit(t+".init",[n]),i[t].forEach(function(e){var o=n[e],i=o||function(){};n[e]=function(){try{var n=arguments,o=this;return Promise.resolve(a.asyncEmit(t+"."+e+":before",n,o)).then(function(){return Promise.resolve(i.apply(o,n)).then(function(){return Promise.resolve(a.asyncEmit(t+"."+e+":after",n,o)).then(function(){})})})}catch(t){return Promise.reject(t)}},n[e].origin=o}),a.emit(t+".inited",[n])},p=App,h=Page,d=Component;App=function(t){return f("App",t),t.__type__="App",p(t)},App._App=p,App.isApp=u,Page=function(t){return f("Page",t),t.__type__="Page",h(t)},Page._Page=h,Page.isPage=s,Component=function(t){return f("Component",t),t.__type__="Component",d(t)},Component._Component=d,Component.isComponent=c;var l=new Set;function m(){return(m=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t}).apply(this,arguments)}a.use=function(t,n){t.options=n,l.add(t),(0,t.bind(a)(a,n).install)()},a.plugins=l,a.lifeCycles=i,console&&console.info("miniapp-spore: v2.1.0");var g="[object Array]",v="[object Object]";function y(t){return Object.prototype.toString.call(t)}function _(t){var n=y(t);if(n===v){var e={};return Object.keys(t).forEach(function(n){return e[n]=_(t[n])}),e}if(n===g){var o=[];return t.forEach(function(t,n){return o[n]=_(t)}),o}return t}function b(t,n){var e={};return y(t)==v&&(t=_(t)),function t(n,e){if(n!==e){var o=y(n),i=y(e);if(o==v&&i==v)for(var a in e){var r=n[a];void 0===r?n[a]=null:t(r,e[a])}else o==g&&i==g&&n.length>=e.length&&e.forEach(function(e,o){t(n[o],e)})}}(t,n),function t(n,e,o,i){if(n!==e){var a=y(n),r=y(e);if(a==v)if(r!=v||Object.keys(n).length<Object.keys(e).length)P(i,o,n);else{var s=function(a){var r=n[a],s=e[a],c=y(r),u=y(s);if(c!=g&&c!=v)r!=e[a]&&P(i,(""==o?"":o+".")+a,r);else if(c==g)u!=g||r.length<s.length?P(i,(""==o?"":o+".")+a,r):r.forEach(function(n,e){t(n,s[e],(""==o?"":o+".")+a+"["+e+"]",i)});else if(c==v)if(u!=v||Object.keys(r).length<Object.keys(s).length)P(i,(""==o?"":o+".")+a,r);else for(var f in r)t(r[f],s[f],(""==o?"":o+".")+a+"."+f,i)};for(var c in n)s(c)}else a==g?r!=g||n.length<e.length?P(i,o,n):n.forEach(function(n,a){t(n,e[a],o+"["+a+"]",i)}):P(i,o,n)}}(t,n,"",e),e}function P(t,n,e){"[object Function]"!=y(e)&&(t[n]=e)}b.deepCopy=_,a.use(function(t,n){return{install:function(){t.on("Page.onLoad:before",function(){var t=this;setTimeout(function(){t._loaded=!0},10)}),t.on("Page.onShow:after",function(){this._loaded&&this.onBack&&this.onBack()})}}}),a.use(function(t,n){var e=b.deepCopy,o=t.Event,i=t.type,a=t.isComponent,r=t.isPage,s=function(t){return t.replace(/\]$/g,"")},c=function t(n,e){var o=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&o.length){var i=s(o.shift());if("object"!=typeof n||!n||!(i in n))return;return t(n[i],o)}return n},u=new Set,f=function(){function n(t,n,e){if(void 0===t&&(t="$store"),void 0===n&&(n={}),void 0===e&&(e={}),this.asyncSetData=p,!/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t))throw new Error("Store命名空间"+t+"定义不合法，规则与js变量名一致");if(this.namespace=t,Array.from(u).find(function(n){return n.namespace==t}))throw new Error("Store不能同时使用同一个命名空间:"+t);u.add(this),Object.assign(this,o(this._events={})),Object.assign(this,e.actions||{}),this.options=Object.assign({diff:!1},e),this._createDefineData(n)}var a,r=n.prototype;return r.setData=function(t,n){var o=this;"object"==i(t)&&(Object.entries(t).map(function(t){!function t(n,e,o){var i=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&i.length>1){var a=s(i.shift());return t(n=n[a]||(n[a]=i[0]!==s(i[0])?[]:{}),i,o)}return n[s(i[0])]=o,n}(o._defineData,t[0],t[1])}),this._data=e(this._defineData),this.emit("setData",[t],this),this.update(n))},r.$spliceData=function(t,n){var o=this;"object"==i(t)&&(Object.entries(t).map(function(t){var n=t[1],e=c(o._defineData,t[0]);Array.isArray(e)&&[].splice.apply(e,n)}),this._data=e(this._defineData),this.emit("$spliceData",[t],this),this.update(n))},r.clear=function(t){var n=this;Object.entries(this._defineData).map(function(t){n._defineData[t[0]]=null}),this._data=e(this._defineData),this.emit("clear",[],this),this.update(t)},r._createDefineData=function(t){this._defineData=t,this._setComputed(),this._data=e(this._defineData)},r._setComputed=function(){var t=this,n=this;this.options.computed&&Object.entries(this.options.computed).map(function(e){var o=e[0],a=e[1];"function"==i(a)&&(function(t,n,e){void 0===e&&(e={});var o,i,a=Array.isArray(n)?n:n.split(/\.|\[/);if(a.length>1?(o=a.splice(-1)[0],i=c(t,a)):(o=a[0],i=t),o=s(o),"object"==typeof i)return Object.defineProperty(i,o,e)}(t._defineData,o,{enumerable:!0,set:function(){console.warn("计算属性不支持重新赋值")},get:function(){return a.bind(n._defineData)()}})||console.warn("存储【"+t.namespace+"】无法定义计算属性"+o+"，因为在此路径下不是对象类型，无法定义属性。"))})},r.update=function(n){var e=this;void 0===n&&(n=function(){});var o=t.getPage(),i=this.data;if(o){var a,r=((a={})[this.namespace]=i,a);this.options.diff&&(r=h(i,this.namespace,o));var s=[p.bind(o)(r)];return o._coms&&o._coms.forEach(function(t){var n=t.getStores();n&&n.includes(e)&&(e.options.diff&&(r=h(i,e.namespace,t)),s.push(p.bind(t)(r)))}),Promise.all(s).then(function(){return n(i),i})}return Promise.resolve(i)},r.where=function(){var n=this,e=t.getPage(),o=[];return e&&(o.push(e.route),e._coms&&e._coms.forEach(function(t){var e=t.getStores();e&&e.includes(n)&&o.push(t.is)})),o},r.destroy=function(t){var n=this;u.delete(this),this._data={},this._defineData={},t&&this.clear(),["$spliceData","setData","clear","asyncSetData","_setComputed","update","where","destroy"].forEach(function(t){n[t]=function(){throw new Error("Store:["+n.namespace+"]已销毁")}}),this.emit("destroy",[],this)},(a=[{key:"data",get:function(){return this._data}}])&&function(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(n.prototype,a),n}(),p=function(t){var n=this;if(a(this)||r(this)||d(this))return new Promise(function(e){n.setData(t,function(t){e(t)})})},h=function(t,n,e){var o=b(t,e.data[n]),i={};return Object.entries(o).forEach(function(t){i[n+"."+t[0]]=t[1]}),i},d=function(t){return t&&t instanceof f},l=t.isWx?{"Component.didMount":"Component.attached","Component.didUnmount":"Component.detached","Page.onBack":"Page.onBack","Page.onLoad":"Page.onLoad"}:{"Component.didMount":"Component.didMount","Component.didUnmount":"Component.didUnmount","Page.onBack":"Page.onBack","Page.onLoad":"Page.onLoad"};return{install:function(){f.isStore=d,t.on(l["Component.didMount"]+":before",function(){this.$page=this.$page||t.getPage(),this.$page._coms=this.$page._coms||new Set,this.$page._coms.add(this)}),t.on(l["Component.didUnmount"]+":before",function(){this.$page=this.$page||t.getPage(),this.$page._coms=this.$page._coms||new Set,this.$page._coms.delete(this)}),t.on(l["Page.onBack"]+":before",function(){u.forEach(function(t){t.update()})}),t.on(l["Page.onLoad"]+":before",function(){u.forEach(function(t){t.update()})}),t.on("Component.init",function(t){t.data=t.data||{},t.stores=t.stores||[],t.methods=t.methods||{},t.methods.getStores=function(){return t.stores},t.stores.forEach(function(n){t.data[n.namespace]=m({},n.data)}),t.methods.asyncSetData=p}),t.on(l["Component.didMount"]+":before",function(){try{var t=this;return Promise.resolve(Promise.all((t.getStores()||[]).map(function(n){var e,o=n.data,i=((e={})[n.namespace]=o,e);return n.options.diff&&(i=h(o,n.namespace,t)),t.asyncSetData(i)}))).then(function(){})}catch(t){return Promise.reject(t)}}),t.on("Page.init",function(t){t.data=t.data||{},u.forEach(function(n){t.data[n.namespace]=m({},n.data)}),t.asyncSetData=p}),Object.assign(t,{Store:f,asyncSetData:p,isStore:d})}}}),a.isMy&&a.use(function(t,n){var e=function(t){return!Object.keys(t||{}).length};return{install:function(){t.lifeCycles.Component.push("didPropsUpdate"),t.on("Component.init",function(t){t.methods.$$config$$=t}),t.on("Component.didUpdate:before",function(t,n){var o=this,i=this.$$config$$,a=i.didPropsUpdate,r=i.watchProps;if(a.origin||r&&!e(r)){var s=b(this.props,t);if(!e(s)){r=r||{},(a=a||function(){}).bind(this)(s,t);var c=function(n){if(r.hasOwnProperty(n)){var i=r[n],a={};Object.keys(s).map(function(t){(function(t,n){if(void 0===n&&(n=""),"*"==n)return!0;var e=/[\.\[\]]+/g,o=/\]/g,i=t.replace(o,"").split(e),a=n.replace(o,"").split(e);if(a.length>i.length)return!1;for(var r=0;r<a.length;r++)if(a[r]!=i[r])return!1;return!0})(t,n)&&(a[t]=s[t])}),e(a)||i.bind(o)(a,t)}};for(var u in r)c(u)}}})}}}),module.exports=a;
//# sourceMappingURL=miniapp-spore.js.map
