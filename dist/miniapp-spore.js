function t(t){t=t||Object.create(null);var n={on:function(n,e){(t[n]||(t[n]=[])).push(e)},off:function(n,e){t[n]&&(1==arguments.length?t[n]=[]:t[n].splice(t[n].indexOf(e)>>>0,1))},emit:function(n,e,i){void 0===e&&(e=[]);var o=(t[n]||[]).slice().map(function(t){return t.apply(i,e)}),r=(t["*"]||[]).slice().map(function(t){return t.apply(i,[].concat(e,[n]))});return[].concat(o,r)},asyncEmit:function(t,e,i){return void 0===e&&(e=[]),Promise.all(n.emit(t,e,i))}};return n}var n=t({});Object.entries||(Object.entries=function(t){for(var n=Object.keys(t),e=n.length,i=new Array(e);e--;)i[e]=[n[e],t[n[e]]];return i});var e=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},i=function(t){return"object"==e(t)&&"$viewId"in t&&"route"in t},o=function(t){return"object"==e(t)&&"is"in t&&"$page"in t&&"props"in t},r=function(t){return"object"==e(t)&&t==getApp()};Object.assign(n,{type:e,isPage:i,isComponent:o,isApp:r,getPage:function(){var t=getCurrentPages();return t[t.length-1]},Event:t});var a={App:["onLaunch","onShow","onHide","onError","onShareAppMessage"],Page:["onLoad","onShow","onBack","onReady","onHide","onUnload","onTitleClick","onPullDownRefresh","onReachBottom","onShareAppMessage","onOptionMenuClick","onPullIntercept","onTabItemTap","onPageScroll"],Component:["onInit","deriveDataFromProps","didMount","didUpdate","didUnmount"]},s=function(t,e){n.emit(t+".init",[e]),a[t].forEach(function(i){var o=e[i],r=o||function(){};e[i]=function(){try{var e=arguments,o=this;return Promise.resolve(n.asyncEmit(t+"."+i+":before",e,o)).then(function(){return Promise.resolve(r.apply(o,e)).then(function(){return Promise.resolve(n.asyncEmit(t+"."+i+":after",e,o)).then(function(){})})})}catch(t){return Promise.reject(t)}},e[i].origin=o}),n.emit(t+".inited",[e])};n.on("Component.didMount:before",function(){this.$page._coms=this.$page._coms||new Set,this.$page._coms.add(this)}),n.on("Component.didUnmount:before",function(){this.$page._coms=this.$page._coms||new Set,this.$page._coms.delete(this)}),n.on("Page.onLoad:before",function(){var t=this;setTimeout(function(){t._loaded=!0},10)}),n.on("Page.onShow:after",function(){this._loaded&&this.onBack()});var c=App,u=Page,f=Component;App=function(t){return s("App",t),c(t)},App._App=c,App.isApp=r,Page=function(t){return s("Page",t),u(t)},Page._Page=u,Page.isPage=i,Component=function(t){return s("Component",t),f(t)},Component._Component=f,Component.isComponent=o;var p=new Set;function h(){return(h=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)}n.use=function(t,e){t.options=e,p.add(t),(0,t.bind(n)(n,e).install)()},n.plugins=p,n.lifeCycles=a,console&&console.info("miniapp-spore: v2.0.3");var d="[object Array]",l="[object Object]";function m(t){return Object.prototype.toString.call(t)}function v(t,n){var e={};return function t(n,e){if(n!==e){var i=m(n),o=m(e);if(i==l&&o==l)for(var r in e){var a=n[r];void 0===a?n[r]=null:t(a,e[r])}else i==d&&o==d&&n.length>=e.length&&e.forEach(function(e,i){t(n[i],e)})}}(t,n),function t(n,e,i,o){if(n!==e){var r=m(n),a=m(e);if(r==l)if(a!=l||Object.keys(n).length<Object.keys(e).length)g(o,i,n);else{var s=function(r){var a=n[r],s=e[r],c=m(a),u=m(s);if(c!=d&&c!=l)a!=e[r]&&g(o,(""==i?"":i+".")+r,a);else if(c==d)u!=d||a.length<s.length?g(o,(""==i?"":i+".")+r,a):a.forEach(function(n,e){t(n,s[e],(""==i?"":i+".")+r+"["+e+"]",o)});else if(c==l)if(u!=l||Object.keys(a).length<Object.keys(s).length)g(o,(""==i?"":i+".")+r,a);else for(var f in a)t(a[f],s[f],(""==i?"":i+".")+r+"."+f,o)};for(var c in n)s(c)}else r==d?a!=d||n.length<e.length?g(o,i,n):n.forEach(function(n,r){t(n,e[r],i+"["+r+"]",o)}):g(o,i,n)}}(t,n,"",e),e}function g(t,n,e){"[object Function]"!=m(e)&&(t[n]=e)}v.deepCopy=function t(n){var e=m(n);if(e===l){var i={};return Object.keys(n).forEach(function(e){return i[e]=t(n[e])}),i}if(e===d){var o=[];return n.forEach(function(n,e){return o[e]=t(n)}),o}return n},n.use(function(t,n){var e=v.deepCopy,i=t.Event,o=t.type,r=t.isComponent,a=t.isPage,s=function(t){return t.replace(/\]$/g,"")},c=function t(n,e){var i=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&i.length){var o=s(i.shift());if("object"!=typeof n||!n||!(o in n))return;return t(n[o],i)}return n},u=new Set,f=function(){function n(t,n,e){if(void 0===t&&(t="$store"),void 0===n&&(n={}),void 0===e&&(e={}),this.asyncSetData=p,!/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t))throw new Error("Store命名空间"+t+"定义不合法，规则与js变量名一致");if(this.namespace=t,Array.from(u).find(function(n){return n.namespace==t}))throw new Error("Store不能同时使用同一个命名空间:"+t);u.add(this),Object.assign(this,i(this._events={})),Object.assign(this,e.actions||{}),this.options=Object.assign({diff:!1},e),this._createDefineData(n)}var r,a=n.prototype;return a.setData=function(t,n){var i=this;"object"==o(t)&&(Object.entries(t).map(function(t){!function t(n,e,i){var o=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&o.length>1){var r=s(o.shift());return t(n=n[r]||(n[r]=o[0]!==s(o[0])?[]:{}),o,i)}return n[s(o[0])]=i,n}(i._defineData,t[0],t[1])}),this._data=e(this._defineData),this.emit("setData",[t],this),this.update(n))},a.$spliceData=function(t,n){var i=this;"object"==o(t)&&(Object.entries(t).map(function(t){var n=t[1],e=c(i._defineData,t[0]);Array.isArray(e)&&[].splice.apply(e,n)}),this._data=e(this._defineData),this.emit("$spliceData",[t],this),this.update(n))},a.clear=function(t){var n=this;Object.entries(this._defineData).map(function(t){n._defineData[t[0]]=null}),this._data=e(this._defineData),this.emit("clear",[],this),this.update(t)},a._createDefineData=function(t){this._defineData=t,this._setComputed(),this._data=e(this._defineData)},a._setComputed=function(){var t=this,n=this;this.options.computed&&Object.entries(this.options.computed).map(function(e){var i=e[0],r=e[1];"function"==o(r)&&(function(t,n,e){void 0===e&&(e={});var i,o,r=Array.isArray(n)?n:n.split(/\.|\[/);if(r.length>1?(i=r.splice(-1)[0],o=c(t,r)):(i=r[0],o=t),i=s(i),"object"==typeof o)return Object.defineProperty(o,i,e)}(t._defineData,i,{enumerable:!0,set:function(){console.warn("计算属性不支持重新赋值")},get:function(){return r.bind(n._defineData)()}})||console.warn("存储【"+t.namespace+"】无法定义计算属性"+i+"，因为在此路径下不是对象类型，无法定义属性。"))})},a.update=function(n){var e=this;void 0===n&&(n=function(){});var i=t.getPage(),o=this.data;if(i){var r,a=((r={})[this.namespace]=o,r);this.options.diff&&(a=d(o,this.namespace,i));var s=[p.bind(i)(a)];return i._coms&&i._coms.forEach(function(t){t.$stores&&t.$stores.includes(e)&&(e.options.diff&&(a=d(o,e.namespace,t)),s.push(p.bind(t)(a)))}),Promise.all(s).then(function(){return n(o),o})}return Promise.resolve(o)},a.where=function(){var n=this,e=t.getPage(),i=[];return e&&(i.push(e.route),e._coms&&e._coms.forEach(function(t){t.$stores&&t.$stores.includes(n)&&i.push(t.is)})),i},a.destroy=function(t){var n=this;u.delete(this),this._data={},this._defineData={},t&&this.clear(),["$spliceData","setData","clear","asyncSetData","_setComputed","update","where","destroy"].forEach(function(t){n[t]=function(){throw new Error("Store:["+n.namespace+"]已销毁")}}),this.emit("destroy",[],this)},(r=[{key:"data",get:function(){return this._data}}])&&function(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(n.prototype,r),n}(),p=function(t){var n=this;if(r(this)||a(this)||l(this))return new Promise(function(e){n.setData(t,function(t){e(t)})})},d=function(t,n,e){var i=v(t,e.data[n]),o={};return Object.entries(i).forEach(function(t){o[n+"."+t[0]]=t[1]}),o},l=function(t){return!!(t&&t instanceof f)};return{install:function(){f.isStore=l,t.on("Page.onBack:before",function(){u.forEach(function(t){t.update()})}),t.on("Page.onLoad:before",function(){u.forEach(function(t){t.update()})}),t.on("Component.init",function(t){t.data=t.data||{},t.stores=t.stores||[],t.methods=t.methods||{},t.methods.$stores=t.stores,t.methods.$stores.forEach(function(n){t.data[n.namespace]=h({},n.data)}),t.methods.asyncSetData=p}),t.on("Component.didMount:before",function(){try{var t=this;return Promise.resolve(Promise.all(t.$stores.map(function(n){var e,i=n.data,o=((e={})[n.namespace]=i,e);return n.options.diff&&(o=d(i,n.namespace,t)),t.asyncSetData(o)}))).then(function(){})}catch(t){return Promise.reject(t)}}),t.on("Page.init",function(t){t.data=t.data||{},u.forEach(function(n){t.data[n.namespace]=h({},n.data)}),t.asyncSetData=p}),Object.assign(t,{Store:f,asyncSetData:p,isStore:l})}}}),n.use(function(t,n){var e=function(t){return!Object.keys(t||{}).length};return{install:function(){t.lifeCycles.Component.push("didPropsUpdate"),t.on("Component.init",function(t){t.methods.$$config$$=t}),t.on("Component.didUpdate:before",function(t,n){var i=this,o=this.$$config$$,r=o.didPropsUpdate,a=o.watchProps;if(r.origin||a&&!e(a)){var s=v(this.props,t);if(!e(s)){a=a||{},(r=r||function(){}).bind(this)(s,t);var c=function(n){if(a.hasOwnProperty(n)){var o=a[n],r={};Object.keys(s).map(function(t){(function(t,n){if(void 0===n&&(n=""),"*"==n)return!0;var e=/[\.\[\]]+/g,i=/\]/g,o=t.replace(i,"").split(e),r=n.replace(i,"").split(e);if(r.length>o.length)return!1;for(var a=0;a<r.length;a++)if(r[a]!=o[a])return!1;return!0})(t,n)&&(r[t]=s[t])}),e(r)||o.bind(i)(r,t)}};for(var u in a)c(u)}}})}}}),module.exports=n;
//# sourceMappingURL=miniapp-spore.js.map
