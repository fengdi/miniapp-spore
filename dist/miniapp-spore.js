var t="[object Array]",n="[object Object]";function e(a){var i=function(t){return Object.prototype.toString.call(t)}(a);if(i===n){var o={};return Object.keys(a).forEach(function(t){return o[t]=e(a[t])}),o}if(i===t){var r=[];return a.forEach(function(t,n){return r[n]=e(t)}),r}return a}function a(a,r){var c={};return function e(a,i){if(a!==i){var r=o(a),c=o(i);if(r==n&&c==n)for(var s in i){var u=a[s];void 0===u?a[s]=null:e(u,i[s])}else r==t&&c==t&&a.length>=i.length&&i.forEach(function(t,n){e(a[n],t)})}}(a=e(a),r),function e(a,r,c,s){if(a!==r){var u=o(a),f=o(r);if(u==n)if(f!=n||Object.keys(a).length<Object.keys(r).length)i(s,c,a);else{var l=function(u){var f=a[u],l=r[u],d=o(f),h=o(l);if(d!=t&&d!=n)f!=r[u]&&i(s,(""==c?"":c+".")+u,f);else if(d==t)h!=t||f.length<l.length?i(s,(""==c?"":c+".")+u,f):f.forEach(function(t,n){e(t,l[n],(""==c?"":c+".")+u+"["+n+"]",s)});else if(d==n)if(h!=n||Object.keys(f).length<Object.keys(l).length)i(s,(""==c?"":c+".")+u,f);else for(var p in f)e(f[p],l[p],(""==c?"":c+".")+u+"."+p,s)};for(var d in a)l(d)}else u==t?f!=t||a.length<r.length?i(s,c,a):a.forEach(function(t,n){e(t,r[n],c+"["+n+"]",s)}):i(s,c,a)}}(a,r,"",c),c}function i(t,n,e){"[object Function]"!=o(e)&&(t[n]=e)}function o(t){return Object.prototype.toString.call(t)}a.deepCopy=e;var r=App,c=Page,s=Component,u=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},f=!1,l=!1,d=function(){var t;f&&l&&(t=console).log.apply(t,[].slice.call(arguments))},h=function(t,n,e,a){if(!n||!t)return t;var i,o,r;if(void 0===e&&(e=!0),a&&(r=a.length))for(i=0;i<r;i++)(o=a[i])in n&&c(o,t,n,e);else for(o in n)c(o,t,n,e);return t;function c(t,n,e,a){if(a||!(t in n))if("object"==typeof e[t])for(var i in e[t])c(i,n[t],e[t],a);else n[t]=e[t]}},p=function(t,n){void 0===n&&(n=!1);var e=t;n&&(e=t.methods=t.methods||{}),t.throttle=t.throttle||{},Object.keys(t.throttle).forEach(function(n){e[n]&&"function"==u(e[n])&&(e[n]=function(t,n,e,a){var i,o=!1,r=0;function c(){i&&clearTimeout(i)}function s(){var s=this,u=Date.now()-r,f=arguments;function l(){r=Date.now(),e.apply(s,f)}function d(){i=void 0}o||(a&&!i&&l(),c(),void 0===a&&u>t?l():!0!==n&&(i=setTimeout(a?d:l,void 0===a?t-u:t)))}return"boolean"!=typeof n&&(a=e,e=n,n=void 0),s.cancel=function(){c(),o=!0},s}(t.throttle[n]||300,e[n]))})},v=function(){this._oldData=a.deepCopy(this.data)},g=function(){return this._oldData};function b(t,n){var e=u(t);if("object"===e){var a={};return Object.keys(t).forEach(function(n){var e=b(t[n]);e&&(a[n]=e)}),Object.keys(a).length?a:null}if("array"===e){var i=[];return t.forEach(function(t,n){var e=b(t);e&&(i[n]=e)}),i.length?i:null}if("function"===e)return t}var y=function(t,n){var e=this,i="$viewId"in this?"Page":"Component",o=function(t,n){var e={};for(var a in n)/\.|\[|\]/g.test(a)?e[a]=n[a]:t[a]=n[a];return[t,e]}(this.data,t=t||{}),r=a(o[0],this._getOldData());d("[update"+i+"Data]:",Object.assign(r,o[1])),this._setOldData(),this.setData(Object.assign(r,o[1]),function(t){D.call(e),n&&n.call(e,t)})},j=function(t,n){h(this.data,t||{}),this.update({},n)},O=function(t,n){var e=this;this._setOldData(),this.$spliceData(t,function(t){D.call(e),n&&n.call(e,t)})},m=function(t){var n=this;if(t&&t.currentTarget){var e,a=t.currentTarget.dataset.linkkey,i=t.currentTarget.dataset.callback,o="function"==u(n[i])?n[i]:function(){};this.update(((e={})[a]=t.detail.value,e),function(){o.bind(n)(t)})}};function D(){h(this.data,this._computeds),function t(n,e,a,i){var o=u(e);"function"===o?Object.defineProperty(a,i,{enumerable:!0,get:function(){return e.call(n)},set:function(){}}):"object"===o?Object.keys(e).forEach(function(a){t(n,e[a],e,a)}):"array"===o&&e.forEach(function(a,i){t(n,a,e,i)})}(this.data,this.data)}module.exports={mix:h,init:function(t){void 0===t&&(t={}),f=my.isIDE,l=!("debug"in t)||t.debug,d("Miniapp-spore has been initialized."),App=function(t){r(t)},Page=function(t){t.data=Object.assign({},t.data||{}),t.injections=[["update","updatePage"]].concat(t.injections||[]);var n=t.onLoad||function(){};t._setOldData=v,t._getOldData=g,t.onLoad=function(){var t=this;t._computeds=b(this.data),D.call(this),t._setOldData(),n.apply(t,arguments)},t.linkData=m,t.update=y,t.merge=j,t.$splice=O,p(t),c(t)},Component=function(t){var n=t.didMount||function(){};t.didMount=function(){var t=this,e=this.$page,a=e.injections;a.forEach(function(n){var a,i;"string"==u(n)?a=i=n:"array"==u(n)&&(a=n[0],i=n[1]),e[a]?t[i]=e[a].bind(e):console.warn("$page."+a+" is undefined.")}),t._computeds=b(this.data),D.call(this),this._setOldData(),n.apply(t,arguments)},t.data=Object.assign({},t.data||{}),t.methods=Object.assign({},t.methods||{}),t.methods._setOldData=v,t.methods._getOldData=g,t.methods.update=y,t.methods.merge=j,t.methods.$splice=O,t.methods.linkData=m;var e=t.didUpdate;t.didUpdate=function(n,i){var o;e&&e.call(this,n,i),t.didPropsChange&&(o=a(this.props,n))&&t.didPropsChange.call(this,n,o)},p(t,!0),s(t)}},diff:a,deepCopy:a.deepCopy,type:u,log:d,warn:function(){var t;f&&l&&(t=console).warn.apply(t,[].slice.call(arguments))}};
//# sourceMappingURL=miniapp-spore.js.map
