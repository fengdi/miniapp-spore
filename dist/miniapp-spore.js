function t(t){t=t||Object.create(null);var n={on:function(n,e){(t[n]||(t[n]=[])).push(e)},off:function(n,e){t[n]&&(1==arguments.length?t[n]=[]:t[n].splice(t[n].indexOf(e)>>>0,1))},emit:function(n,e,o){void 0===e&&(e=[]);var i=(t[n]||[]).slice().map(function(t){return t.apply(o,e)}),r=(t["*"]||[]).slice().map(function(t){return t.apply(o,[].concat(e,[n]))});return[].concat(i,r)},asyncEmit:function(t,e,o){return void 0===e&&(e=[]),Promise.all(n.emit(t,e,o))}};return n}var n=t({});Object.entries||(Object.entries=function(t){for(var n=Object.keys(t),e=n.length,o=new Array(e);e--;)o[e]=[n[e],t[n[e]]];return o});var e=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},o=function(t){return"object"==e(t)&&"$viewId"in t&&"route"in t},i=function(t){return"object"==e(t)&&"is"in t&&"$page"in t&&"props"in t},r=function(t){return"object"==e(t)&&t==getApp()};Object.assign(n,{type:e,isPage:o,isComponent:i,isApp:r,getPage:function(){var t=getCurrentPages();return t[t.length-1]},Event:t});var a={App:["onLaunch","onShow","onHide","onError","onShareAppMessage"],Page:["onLoad","onShow","onBack","onReady","onHide","onUnload","onTitleClick","onPullDownRefresh","onReachBottom","onShareAppMessage","onOptionMenuClick","onPullIntercept","onTabItemTap","onPageScroll"],Component:["onInit","deriveDataFromProps","didMount","didUpdate","didUnmount"]},s=function(t,e){n.emit(t+".init",[e]),a[t].forEach(function(o){var i=e[o]||function(){};e[o]=function(){try{var e=arguments,r=this;return Promise.resolve(n.asyncEmit(t+"."+o+":before",e,r)).then(function(){return Promise.resolve(i.apply(r,e)).then(function(){return Promise.resolve(n.asyncEmit(t+"."+o+":after",e,r)).then(function(){})})})}catch(t){return Promise.reject(t)}}}),n.emit(t+".inited",[e])};n.on("Component.didMount:before",function(){this.$page._coms=this.$page._coms||new Set,this.$page._coms.add(this)}),n.on("Component.didUnmount:before",function(){this.$page._coms=this.$page._coms||new Set,this.$page._coms.delete(this)}),n.on("Page.onLoad:before",function(){var t=this;setTimeout(function(){t._loaded=!0},10)}),n.on("Page.onShow:after",function(){this._loaded&&this.onBack()});var c=App,u=Page,f=Component;App=function(t){return s("App",t),c(t)},App._App=c,App.isApp=r,Page=function(t){return s("Page",t),u(t)},Page._Page=u,Page.isPage=o,Component=function(t){return s("Component",t),f(t)},Component._Component=f,Component.isComponent=i;var p=new Set;function h(){return(h=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t}).apply(this,arguments)}n.use=function(t,e){t.options=e,p.add(t),(0,t.bind(n)(n,e).install)()},n.plugins=p,n.lifeCycles=a,console&&console.info("miniapp-spore: v2.0.1");var d="[object Array]",l="[object Object]";function m(t){var n=function(t){return Object.prototype.toString.call(t)}(t);if(n===l){var e={};return Object.keys(t).forEach(function(n){return e[n]=m(t[n])}),e}if(n===d){var o=[];return t.forEach(function(t,n){return o[n]=m(t)}),o}return t}function v(t,n){var e={};return function t(n,e){if(n!==e){var o=b(n),i=b(e);if(o==l&&i==l)for(var r in e){var a=n[r];void 0===a?n[r]=null:t(a,e[r])}else o==d&&i==d&&n.length>=e.length&&e.forEach(function(e,o){t(n[o],e)})}}(t=m(t),n),function t(n,e,o,i){if(n!==e){var r=b(n),a=b(e);if(r==l)if(a!=l||Object.keys(n).length<Object.keys(e).length)g(i,o,n);else{var s=function(r){var a=n[r],s=e[r],c=b(a),u=b(s);if(c!=d&&c!=l)a!=e[r]&&g(i,(""==o?"":o+".")+r,a);else if(c==d)u!=d||a.length<s.length?g(i,(""==o?"":o+".")+r,a):a.forEach(function(n,e){t(n,s[e],(""==o?"":o+".")+r+"["+e+"]",i)});else if(c==l)if(u!=l||Object.keys(a).length<Object.keys(s).length)g(i,(""==o?"":o+".")+r,a);else for(var f in a)t(a[f],s[f],(""==o?"":o+".")+r+"."+f,i)};for(var c in n)s(c)}else r==d?a!=d||n.length<e.length?g(i,o,n):n.forEach(function(n,r){t(n,e[r],o+"["+r+"]",i)}):g(i,o,n)}}(t,n,"",e),e}function g(t,n,e){"[object Function]"!=b(e)&&(t[n]=e)}function b(t){return Object.prototype.toString.call(t)}v.deepCopy=m,n.use(function(t,n){var e=v.deepCopy,o=t.Event,i=t.type,r=t.isComponent,a=t.isPage,s=function(t){return t.replace(/\]$/g,"")},c=function t(n,e){var o=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&o.length){var i=s(o.shift());if("object"!=typeof n||!(i in n))return;return t(n[i],o)}return n},u=new Set,f=function(){function n(t,n,i){if(void 0===t&&(t="$store"),void 0===n&&(n={}),void 0===i&&(i={}),this.asyncSetData=p,!/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t))throw new Error("Store命名空间"+t+"定义不合法，规则与js变量名一致");if(this._defData=n,Object.assign(this,o(this._events={})),this.options=Object.assign({diff:!1},i),this.namespace=t,this._setComputed(),this._data=e(this._defData),Array.from(u).find(function(n){return n.namespace==t}))throw new Error("Store不能同时使用同一个命名空间:"+t);u.add(this)}var r,a=n.prototype;return a.setData=function(t,n){var o=this;"object"==i(t)&&(Object.entries(t).map(function(t){!function t(n,e,o){var i=Array.isArray(e)?e:e.split(/\.|\[/);if(e&&i.length>1){var r=s(i.shift());return t(n=n[r]||(n[r]=i[0]!==s(i[0])?[]:{}),i,o)}return n[s(i[0])]=o,n}(o._defData,t[0],t[1])}),this._data=e(this._defData),this.emit("setData",[t],this),this.update(n))},a.$spliceData=function(t,n){var o=this;"object"==i(t)&&(Object.entries(t).map(function(t){var n=t[1],e=c(o._defData,t[0]);Array.isArray(e)&&[].splice.apply(e,n)}),this._data=e(this._defData),this.emit("$spliceData",[t],this),this.update(n))},a.clear=function(t){var n=this;Object.entries(this._defData).map(function(t){n._defData[t[0]]=null}),this._data=e(this._defData),this.emit("clear",[],this),this.update(t)},a._setComputed=function(){var t=this,n=this;this.options.computed&&Object.entries(this.options.computed).map(function(e){var o=e[0],r=e[1];"function"==i(r)&&(function(t,n,e){void 0===e&&(e={});var o,i,r=Array.isArray(n)?n:n.split(/\.|\[/);if(r.length>1?(o=r.splice(-1)[0],i=c(t,r)):(o=r[0],i=t),o=s(o),"object"==typeof i)return Object.defineProperty(i,o,e)}(t._defData,o,{enumerable:!0,set:function(){console.warn("计算属性不支持重新赋值")},get:function(){return r.bind(n._defData)()}})||console.warn("存储【"+t.namespace+"】无法定义计算属性"+o+"，因为在此路径下不是对象类型，无法定义属性。"))})},a.update=function(n){var e=this;void 0===n&&(n=function(){});var o=t.getPage(),i=this.data;if(o){var r,a=((r={})[this.namespace]=i,r);this.options.diff&&(a=d(i,this.namespace,o));var s=[p.bind(o)(a)];return o._coms&&o._coms.forEach(function(t){t.$stores&&t.$stores.includes(e)&&(e.options.diff&&(a=d(i,e.namespace,t)),s.push(p.bind(t)(a)))}),Promise.all(s).then(function(){return n(i),i})}return Promise.resolve(i)},a.where=function(){var n=this,e=t.getPage(),o=[];return e&&(o.push(e.route),e._coms&&e._coms.forEach(function(t){t.$stores&&t.$stores.includes(n)&&o.push(t.is)})),o},a.destroy=function(t){var n=this;u.delete(this),this._data={},this._defData={},t&&this.clear(),["$spliceData","setData","clear","asyncSetData","_setComputed","update","where","destroy"].forEach(function(t){n[t]=function(){throw new Error("Store:["+n.namespace+"]已销毁")}}),this.emit("destroy",[],this)},(r=[{key:"data",get:function(){return this._data}}])&&function(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(n.prototype,r),n}(),p=function(t){var n=this;if(r(this)||a(this)||l(this))return new Promise(function(e){n.setData(t,function(t){e(t)})})},d=function(t,n,e){var o=v(t,e.data[n]),i={};return Object.entries(o).forEach(function(t){i[n+"."+t[0]]=t[1]}),i},l=function(t){return!!(t&&t instanceof f)};return{install:function(){f.isStore=l,t.on("Page.onBack:before",function(){u.forEach(function(t){t.update()})}),t.on("Page.onLoad:before",function(){u.forEach(function(t){t.update()})}),t.on("Component.init",function(t){t.data=t.data||{},t.stores=t.stores||[],t.methods=t.methods||{},t.methods.$stores=t.stores,t.methods.$stores.forEach(function(n){t.data[n.namespace]=h({},n.data)}),t.methods.asyncSetData=p}),t.on("Page.init",function(t){t.data=t.data||{},u.forEach(function(n){t.data[n.namespace]=h({},n.data)}),t.asyncSetData=p}),Object.assign(t,{Store:f,asyncSetData:p,isStore:l})}}}),n.use(function(t,n){var e=function(t){return!Object.keys(t||{}).length};return{install:function(){t.lifeCycles.Component.push("didPropsUpdate"),t.on("Component.init",function(t){t.methods.$$config$$=t}),t.on("Component.didUpdate:before",function(t,n){var o=this,i=v(this.props,t);if(!e(i)){var r=this.$$config$$.watchProps||{};(this.$$config$$.didPropsUpdate||function(){}).bind(this)(i,t);var a=function(n){if(r.hasOwnProperty(n)){var a=r[n],s={};Object.keys(i).map(function(t){(function(t,n){if(void 0===n&&(n=""),"*"==n)return!0;var e=/[\.\[\]]+/g,o=/\]/g,i=t.replace(o,"").split(e),r=n.replace(o,"").split(e);if(r.length>i.length)return!1;for(var a=0;a<r.length;a++)if(r[a]!=i[a])return!1;return!0})(t,n)&&(s[t]=i[t])}),e(s)||a.bind(o)(s,t)}};for(var s in r)a(s)}})}}}),module.exports=n;
//# sourceMappingURL=miniapp-spore.js.map
