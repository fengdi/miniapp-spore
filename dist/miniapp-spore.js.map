{"version":3,"file":"miniapp-spore.js","sources":["../src/diff.js","../src/aliapp.js","../src/throttle-debounce.js"],"sourcesContent":["const ARRAYTYPE = '[object Array]'\r\nconst OBJECTTYPE = '[object Object]'\r\nconst FUNCTIONTYPE = '[object Function]'\r\n//https://github.com/yisar/fard/blob/master/packages/fard/index.js\r\n//https://github.com/linjc/dd-store/blob/master/src/create.js\r\n//https://github.com/Tencent/westore/blob/master/packages/westore/utils/diff.js\r\n\r\nfunction getType(obj) {\r\n  return Object.prototype.toString.call(obj)\r\n}\r\n\r\nfunction deepCopy(data) {\r\n  const type = getType(data)\r\n  if (type === OBJECTTYPE) {\r\n    const obj = {}\r\n    Object.keys(data).forEach(key => obj[key] = deepCopy(data[key]))\r\n    return obj\r\n  }\r\n  if (type === ARRAYTYPE) {\r\n    const arr = []\r\n    data.forEach((item, index) => arr[index] = deepCopy(item))\r\n    return arr\r\n  }\r\n  return data\r\n}\r\n\r\n//JSON.parse(JSON.stringify(current))//\r\n\r\nexport default function diff(current, pre) {\r\n    current = deepCopy(current)\r\n    const result = {}\r\n    syncKeys(current, pre)\r\n    _diff(current, pre, '', result)\r\n    return result\r\n}\r\n\r\ndiff.deepCopy = deepCopy;\r\n\r\nfunction syncKeys(current, pre) {\r\n    if (current === pre) return\r\n    const rootCurrentType = type(current)\r\n    const rootPreType = type(pre)\r\n    if (rootCurrentType == OBJECTTYPE && rootPreType == OBJECTTYPE) {\r\n        //if(Object.keys(current).length >= Object.keys(pre).length){\r\n            for (let key in pre) {\r\n                const currentValue = current[key]\r\n                if (currentValue === undefined) {\r\n                    current[key] = null\r\n                } else {\r\n                    syncKeys(currentValue, pre[key])\r\n                }\r\n            }\r\n        //}\r\n    } else if (rootCurrentType == ARRAYTYPE && rootPreType == ARRAYTYPE) {\r\n        if (current.length >= pre.length) {\r\n            pre.forEach((item, index) => {\r\n                syncKeys(current[index], item)\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nfunction _diff(current, pre, path, result) {\r\n    if (current === pre) return\r\n    const rootCurrentType = type(current)\r\n    const rootPreType = type(pre)\r\n    if (rootCurrentType == OBJECTTYPE) {\r\n        if (rootPreType != OBJECTTYPE || Object.keys(current).length < Object.keys(pre).length) {\r\n            setResult(result, path, current)\r\n        } else {\r\n            for (let key in current) {\r\n                const currentValue = current[key]\r\n                const preValue = pre[key]\r\n                const currentType = type(currentValue)\r\n                const preType = type(preValue)\r\n                if (currentType != ARRAYTYPE && currentType != OBJECTTYPE) {\r\n                    if (currentValue != pre[key]) {\r\n                        setResult(result, (path == '' ? '' : path + \".\") + key, currentValue)\r\n                    }\r\n                } else if (currentType == ARRAYTYPE) {\r\n                    if (preType != ARRAYTYPE) {\r\n                        setResult(result, (path == '' ? '' : path + \".\") + key, currentValue)\r\n                    } else {\r\n                        if (currentValue.length < preValue.length) {\r\n                            setResult(result, (path == '' ? '' : path + \".\") + key, currentValue)\r\n                        } else {\r\n                            currentValue.forEach((item, index) => {\r\n                                _diff(item, preValue[index], (path == '' ? '' : path + \".\") + key + '[' + index + ']', result)\r\n                            })\r\n                        }\r\n                    }\r\n                } else if (currentType == OBJECTTYPE) {\r\n                    if (preType != OBJECTTYPE || Object.keys(currentValue).length < Object.keys(preValue).length) {\r\n                        setResult(result, (path == '' ? '' : path + \".\") + key, currentValue)\r\n                    } else {\r\n                        for (let subKey in currentValue) {\r\n                            _diff(currentValue[subKey], preValue[subKey], (path == '' ? '' : path + \".\") + key + '.' + subKey, result)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    } else if (rootCurrentType == ARRAYTYPE) {\r\n        if (rootPreType != ARRAYTYPE) {\r\n            setResult(result, path, current)\r\n        } else {\r\n            if (current.length < pre.length) {\r\n                setResult(result, path, current)\r\n            } else {\r\n                current.forEach((item, index) => {\r\n                    _diff(item, pre[index], path + '[' + index + ']', result)\r\n                })\r\n            }\r\n        }\r\n    } else {\r\n        setResult(result, path, current)\r\n    }\r\n}\r\n\r\nfunction setResult(result, k, v) {\r\n    if (type(v) != FUNCTIONTYPE) {\r\n        result[k] = v\r\n    }\r\n}\r\n\r\nfunction type(obj) {\r\n    return Object.prototype.toString.call(obj)\r\n}","// tangoboy\r\n\r\nimport diff from \"./diff.js\";\r\nimport { throttle, debounce } from \"./throttle-debounce\";\r\n\r\n\r\n\r\nconst systemApp = App;\r\nconst systemPage = Page;\r\nconst systemComponent = Component;\r\n\r\n\r\nconst type = (t)=>{\r\n    return {}.toString.call(t).slice(8,-1).toLowerCase();\r\n}\r\n\r\nlet isIDE = false;\r\nlet debug = false;\r\n\r\nlet warn = (...msg)=>{\r\n    if(isIDE && debug){\r\n        console.warn(...msg);\r\n    }\r\n};\r\nlet log = (...msg)=>{\r\n    if(isIDE && debug){\r\n        console.log(...msg);\r\n    }\r\n};\r\n\r\n\r\n\r\n//深度 混合/糅杂\r\nconst mix = function(receiver, supplier, override, whitelist) {\r\n    if (!supplier || !receiver) return receiver;\r\n    if (override === undefined) override = true;\r\n    var i, p, len;\r\n\r\n    if (whitelist && (len = whitelist.length)) {\r\n        for (i = 0; i < len; i++) {\r\n            p = whitelist[i];\r\n            if (p in supplier) {\r\n                _mix(p, receiver, supplier, override);\r\n            }\r\n        }\r\n    } else {\r\n        for (p in supplier) {\r\n            _mix(p, receiver, supplier, override);\r\n        }\r\n    }\r\n    return receiver;\r\n\r\n    function _mix(property, receiver, supplier, override) {\r\n        if (override || !(property in receiver)) {\r\n            if(typeof supplier[property] == 'object'){\r\n                for(var k in supplier[property]){\r\n                    _mix(k, receiver[property], supplier[property], override)\r\n                }\r\n            }else{\r\n                receiver[property] = supplier[property];\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n//分离键值更新和路径更新\r\nconst assignObject = (a, b)=>{\r\n    let path = {};\r\n    for(let k in b){\r\n        //path 更新 \"a.b.c[0].d.e\"分离到path\r\n        //a  为纯粹的键值更新\r\n        if(!/\\.|\\[|\\]/g.test(k)){\r\n            a[k] = b[k];\r\n        }else{\r\n            path[k] = b[k];\r\n        }\r\n    }\r\n    // console.log(\"assignObject\", a, path)\r\n    return [a, path];\r\n}\r\n\r\n//处理防抖\r\nlet initThrottle = (config, isComponent=false ) =>{\r\n\r\n    let host = config;\r\n    if(isComponent){\r\n        host = config.methods = config.methods || {};\r\n    }\r\n\r\n    config.throttle = config.throttle || {};\r\n\r\n    Object.keys(config.throttle).forEach( fnName => {\r\n        if( host[fnName] && type(host[fnName]) == 'function' ){\r\n            let delay = config.throttle[fnName] || 300;\r\n            host[fnName] = throttle(delay, host[fnName]);\r\n        }\r\n    })\r\n}\r\n\r\nconst setOldData = function(){\r\n    this._oldData = diff.deepCopy(this.data)//JSON.parse(JSON.stringify(this.data));\r\n};\r\nconst getOldData = function(){\r\n    return this._oldData;\r\n};\r\n\r\n//遍历data树取出计算方法树\r\nfunction computedFnwalk(data, key){\r\n    let t = type(data);\r\n    if (t === 'object') {\r\n        let r = {};\r\n        Object.keys(data).forEach(key =>{ \r\n            let d = computedFnwalk(data[key], key);\r\n            if(d){\r\n                r[key] = d\r\n            }\r\n        })\r\n        return Object.keys(r).length ? r : null;\r\n    }\r\n    if (t === 'array') {\r\n        let r = [];\r\n        data.forEach((item, index) =>{\r\n            let d = computedFnwalk(item, index)\r\n            if(d){\r\n                r[index] = d\r\n            }\r\n        })\r\n        return r.length ? r : null;\r\n    }\r\n    if( t === 'function'){\r\n        return data;\r\n    }\r\n}\r\n\r\nconst update = function (data, callback){\r\n\r\n    let type = ('$viewId' in this) ? 'Page' : 'Component';\r\n\r\n    data = data || {};\r\n    //newDataArray分为\r\n    //newDataArray[0]  为纯粹的键值更新 比如： \"foo\" : \"bar\"\r\n    //newDataArray[1]  路径更新 更新   比如： \"a.b.c[0].d.e\" : \"zoo\"\r\n    // 分离出来后 键值更新 去diff对比优化生成 update\r\n    // 之后 update 与 newDataArray[1] 合并路径更新再进行setData\r\n    const newDataArray = assignObject(this.data, data);\r\n    // console.log(\"newDataArray\", newDataArray)\r\n    const update = diff(newDataArray[0], this._getOldData());\r\n\r\n    // log(`[update${type}Data]:`, update, newDataArray[1]);\r\n    log(`[update${type}Data]:`, Object.assign(update, newDataArray[1]));\r\n    this._setOldData();\r\n    this.setData(Object.assign(update, newDataArray[1]), (data)=>{\r\n        updateComputed.call(this)\r\n        callback && callback.call(this, data);\r\n    })\r\n}\r\nconst merge = function(mergedata, callback){\r\n    mix(this.data, mergedata||{});\r\n    this.update({}, callback);\r\n};\r\nconst $splice = function(data, callback){\r\n    this._setOldData();\r\n    this.$spliceData(data, (data)=>{\r\n        updateComputed.call(this)\r\n        callback && callback.call(this, data);\r\n    });\r\n};\r\nconst linkData = function(e){\r\n    let self = this;\r\n\r\n    if(e && e.currentTarget){\r\n        let key = e.currentTarget.dataset.linkkey;\r\n        let callbackKey = e.currentTarget.dataset.callback;\r\n        let callback = type(self[callbackKey]) == 'function' ? self[callbackKey] : function(){}\r\n\r\n        this.update({\r\n            [key] : e.detail.value\r\n        }, ()=>{\r\n            // console.log(this.data)\r\n            callback.bind(self)(e);\r\n        })\r\n    }\r\n};\r\n\r\nfunction setComputed(storeData, value, obj, key) {\r\n  const typeString = type(value)\r\n  if (typeString === 'function') {\r\n    Object.defineProperty(obj, key, {\r\n      enumerable: true,\r\n      get: function () {\r\n        return value.call(storeData)\r\n      },\r\n      set: function () {\r\n        // console.warn('计算属性不支持重新赋值')\r\n      }\r\n    })\r\n  } else if (typeString === 'object') {\r\n    Object.keys(value).forEach(subKey => {\r\n      setComputed(storeData, value[subKey], value, subKey)\r\n    })\r\n  } else if (typeString === 'array') {\r\n    value.forEach((item, index) => {\r\n      setComputed(storeData, item, value, index)\r\n    })\r\n  }\r\n}\r\n\r\n//更新计算方法，每次setData更新了一次，因为setData后data中的getter会被过滤掉\r\nfunction updateComputed() {\r\n    let computeds = this._computeds;\r\n    mix(this.data, this._computeds);\r\n    setComputed(this.data, this.data);\r\n}\r\n\r\n\r\nconst init = (option = {})=>{\r\n    \r\n    isIDE = my.isIDE;\r\n    debug = 'debug'in option? option.debug : true;\r\n\r\n\r\n    log('Miniapp-spore has been initialized.');\r\n\r\n    App = function(config){\r\n\r\n        systemApp(config);\r\n    };\r\n    Page = function(config){\r\n        \r\n        config.data = Object.assign({}, config.data||{})\r\n        \r\n        //注入函数名称\r\n        config.injections = [[\"update\", \"updatePage\"]].concat(config.injections || []);\r\n        \r\n        \r\n        const onLoad = config.onLoad||function(){};\r\n        config._setOldData = setOldData;\r\n        config._getOldData = getOldData;\r\n\r\n        config.onLoad = function(){\r\n            let self = this;\r\n\r\n            self._computeds = computedFnwalk(this.data);\r\n\r\n            updateComputed.call(this);\r\n            \r\n            self._setOldData()\r\n            // const setData = self.setData;\r\n            // self.setData = function(){\r\n            //     // console.log(\"setData:\", arguments[0])\r\n            //     self._setOldData()\r\n            //     setData.apply(self, arguments)\r\n            // };\r\n\r\n            onLoad.apply(self, arguments);\r\n        }\r\n\r\n        config.linkData = linkData;\r\n\r\n        config.update = update;\r\n        config.merge = merge;\r\n        config.$splice = $splice;\r\n\r\n        //防抖名单\r\n        initThrottle(config);\r\n\r\n        systemPage(config);\r\n    };\r\n\r\n    Component = function(config){\r\n        \r\n\r\n        const didMount = config.didMount || function(){};\r\n\r\n        \r\n\r\n        config.didMount = function(){\r\n            let self = this;\r\n            \r\n            let $page = this.$page;\r\n            let injections = $page.injections;\r\n            injections.forEach(name=>{\r\n                let fromKey;\r\n                let toKey;\r\n                if(type(name)=='string'){\r\n                    fromKey = toKey = name;\r\n                }else if(type(name)=='array'){\r\n                    fromKey = name[0];\r\n                    toKey   = name[1];\r\n                }\r\n                if($page[fromKey]){\r\n                    self[toKey] = $page[fromKey].bind($page);\r\n                }else{\r\n                    console.warn(`$page.${fromKey} is undefined.`)\r\n                }\r\n            });\r\n            \r\n            self._computeds = computedFnwalk(this.data);\r\n\r\n            updateComputed.call(this);\r\n\r\n            this._setOldData();\r\n            // console.log(self);\r\n\r\n            didMount.apply(self, arguments);\r\n        }\r\n\r\n        config.data = Object.assign({}, config.data||{})\r\n        config.methods = Object.assign({}, config.methods||{})\r\n\r\n        config.methods._setOldData = setOldData;\r\n        config.methods._getOldData = getOldData;\r\n\r\n        config.methods.update = update;\r\n        config.methods.merge = merge;\r\n        config.methods.$splice = $splice;\r\n\r\n        config.methods.linkData = linkData;\r\n\r\n        // didPropsChange 生命周期\r\n        let didUpdate = config.didUpdate;\r\n        config.didUpdate = function(prevProps, prevData){\r\n            didUpdate && didUpdate.call(this, prevProps, prevData);\r\n            if(config.didPropsChange){\r\n                let d;\r\n                if(d = diff(this.props, prevProps)){\r\n                    config.didPropsChange.call(this, prevProps, d)\r\n                }\r\n            }\r\n        }\r\n\r\n        //防抖名单\r\n        initThrottle(config, true)\r\n\r\n        systemComponent(config);\r\n    };\r\n}\r\n\r\n\r\n\r\n\r\nexport default {\r\n    mix,\r\n    init,\r\n    diff,\r\n    deepCopy: diff.deepCopy,\r\n    type,\r\n    log,\r\n    warn\r\n}","/* eslint-disable no-undefined,no-param-reassign,no-shadow */\r\n\r\n/**\r\n * Throttle execution of a function. Especially useful for rate limiting\r\n * execution of handlers on events like resize and scroll.\r\n *\r\n * @param  {Number}    delay          A zero-or-greater delay in milliseconds. For event callbacks, values around 100 or 250 (or even higher) are most useful.\r\n * @param  {Boolean}   [noTrailing]   Optional, defaults to false. If noTrailing is true, callback will only execute every `delay` milliseconds while the\r\n *                                    throttled-function is being called. If noTrailing is false or unspecified, callback will be executed one final time\r\n *                                    after the last throttled-function call. (After the throttled-function has not been called for `delay` milliseconds,\r\n *                                    the internal counter is reset)\r\n * @param  {Function}  callback       A function to be executed after delay milliseconds. The `this` context and all arguments are passed through, as-is,\r\n *                                    to `callback` when the throttled-function is executed.\r\n * @param  {Boolean}   [debounceMode] If `debounceMode` is true (at begin), schedule `clear` to execute after `delay` ms. If `debounceMode` is false (at end),\r\n *                                    schedule `callback` to execute after `delay` ms.\r\n *\r\n * @return {Function}  A new, throttled, function.\r\n */\r\nfunction throttle (delay, noTrailing, callback, debounceMode) {\r\n  /*\r\n   * After wrapper has stopped being called, this timeout ensures that\r\n   * `callback` is executed at the proper times in `throttle` and `end`\r\n   * debounce modes.\r\n   */\r\n  var timeoutID;\r\n  var cancelled = false; // Keep track of the last time `callback` was executed.\r\n\r\n  var lastExec = 0; // Function to clear existing timeout\r\n\r\n  function clearExistingTimeout() {\r\n    if (timeoutID) {\r\n      clearTimeout(timeoutID);\r\n    }\r\n  } // Function to cancel next exec\r\n\r\n\r\n  function cancel() {\r\n    clearExistingTimeout();\r\n    cancelled = true;\r\n  } // `noTrailing` defaults to falsy.\r\n\r\n\r\n  if (typeof noTrailing !== 'boolean') {\r\n    debounceMode = callback;\r\n    callback = noTrailing;\r\n    noTrailing = undefined;\r\n  }\r\n  /*\r\n   * The `wrapper` function encapsulates all of the throttling / debouncing\r\n   * functionality and when executed will limit the rate at which `callback`\r\n   * is executed.\r\n   */\r\n\r\n\r\n  function wrapper() {\r\n    var self = this;\r\n    var elapsed = Date.now() - lastExec;\r\n    var args = arguments;\r\n\r\n    if (cancelled) {\r\n      return;\r\n    } // Execute `callback` and update the `lastExec` timestamp.\r\n\r\n\r\n    function exec() {\r\n      lastExec = Date.now();\r\n      callback.apply(self, args);\r\n    }\r\n    /*\r\n     * If `debounceMode` is true (at begin) this is used to clear the flag\r\n     * to allow future `callback` executions.\r\n     */\r\n\r\n\r\n    function clear() {\r\n      timeoutID = undefined;\r\n    }\r\n\r\n    if (debounceMode && !timeoutID) {\r\n      /*\r\n       * Since `wrapper` is being called for the first time and\r\n       * `debounceMode` is true (at begin), execute `callback`.\r\n       */\r\n      exec();\r\n    }\r\n\r\n    clearExistingTimeout();\r\n\r\n    if (debounceMode === undefined && elapsed > delay) {\r\n      /*\r\n       * In throttle mode, if `delay` time has been exceeded, execute\r\n       * `callback`.\r\n       */\r\n      exec();\r\n    } else if (noTrailing !== true) {\r\n      /*\r\n       * In trailing throttle mode, since `delay` time has not been\r\n       * exceeded, schedule `callback` to execute `delay` ms after most\r\n       * recent execution.\r\n       *\r\n       * If `debounceMode` is true (at begin), schedule `clear` to execute\r\n       * after `delay` ms.\r\n       *\r\n       * If `debounceMode` is false (at end), schedule `callback` to\r\n       * execute after `delay` ms.\r\n       */\r\n      timeoutID = setTimeout(debounceMode ? clear : exec, debounceMode === undefined ? delay - elapsed : delay);\r\n    }\r\n  }\r\n\r\n  wrapper.cancel = cancel; // Return the wrapper function.\r\n\r\n  return wrapper;\r\n}\r\n\r\n/* eslint-disable no-undefined */\r\n/**\r\n * Debounce execution of a function. Debouncing, unlike throttling,\r\n * guarantees that a function is only executed a single time, either at the\r\n * very beginning of a series of calls, or at the very end.\r\n *\r\n * @param  {Number}   delay         A zero-or-greater delay in milliseconds. For event callbacks, values around 100 or 250 (or even higher) are most useful.\r\n * @param  {Boolean}  [atBegin]     Optional, defaults to false. If atBegin is false or unspecified, callback will only be executed `delay` milliseconds\r\n *                                  after the last debounced-function call. If atBegin is true, callback will be executed only at the first debounced-function call.\r\n *                                  (After the throttled-function has not been called for `delay` milliseconds, the internal counter is reset).\r\n * @param  {Function} callback      A function to be executed after delay milliseconds. The `this` context and all arguments are passed through, as-is,\r\n *                                  to `callback` when the debounced-function is executed.\r\n *\r\n * @return {Function} A new, debounced function.\r\n */\r\n\r\nfunction debounce (delay, atBegin, callback) {\r\n  return callback === undefined ? throttle(delay, atBegin, false) : throttle(delay, callback, atBegin !== false);\r\n}\r\n\r\nexport { throttle, debounce };\r\n"],"names":["ARRAYTYPE","OBJECTTYPE","deepCopy","data","type","obj","Object","prototype","toString","call","getType","keys","forEach","key","arr","item","index","diff","current","pre","result","syncKeys","rootCurrentType","rootPreType","currentValue","undefined","length","_diff","path","setResult","preValue","currentType","preType","subKey","k","v","systemApp","App","systemPage","Page","systemComponent","Component","t","slice","toLowerCase","isIDE","debug","log","console","mix","receiver","supplier","override","whitelist","i","p","len","_mix","property","initThrottle","config","isComponent","host","methods","throttle","fnName","delay","noTrailing","callback","debounceMode","timeoutID","cancelled","lastExec","clearExistingTimeout","clearTimeout","wrapper","self","this","elapsed","Date","now","args","arguments","exec","apply","clear","setTimeout","cancel","setOldData","_oldData","getOldData","computedFnwalk","r","d","update","newDataArray","a","b","test","assignObject","_getOldData","assign","_setOldData","setData","updateComputed","_this","merge","mergedata","$splice","$spliceData","_this2","linkData","e","currentTarget","dataset","linkkey","callbackKey","detail","value","bind","_computeds","setComputed","storeData","typeString","defineProperty","enumerable","get","set","init","option","my","injections","concat","onLoad","didMount","$page","name","fromKey","toKey","warn","didUpdate","prevProps","prevData","didPropsChange","props"],"mappings":"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"}