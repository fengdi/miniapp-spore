# é˜¿é‡Œå°ç¨‹åºæ¸è¿›æ¡†æ¶ miniapp-spore #

## å‰è¨€ ##

ä¹‹å‰ï¼Œæˆ‘å°è¯•ç›´æ¥ç”¨taro remax raxç­‰å¼€å‘å°ç¨‹åºï¼Œå…¶å®å¼€å‘æ•ˆç‡å’Œæ€§èƒ½éƒ½å¯ä»¥è¾¾æ ‡çš„ã€‚æˆ‘ä¹Ÿæ›´æ¨èç”¨reactå¼€å‘å°ç¨‹åºï¼Œä¹‹å‰æœ‰é¡¹ç›®ç”¨remaxå’Œraxåšè¿‡ã€‚å…¶å®åªæœ‰ä¸¤ä¸ªå¼€å‘ä½“éªŒä¸Šçš„é—®é¢˜ï¼Œå…¶ä¸€æ¯æ¬¡ä¿å­˜æ–‡ä»¶ï¼Œæ¡†æ¶å…ˆç¼–è¯‘ä¹‹åå°ç¨‹åºå¼€å‘å·¥å…·æ£€æµ‹æ–‡ä»¶ä¿®æ”¹å†è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ï¼Œä¸¤æ¬¡ç¼–è¯‘æ—¶é—´æ¯”è¾ƒé•¿ï¼Œè‡³å°‘è¾¾åˆ°5ç§’ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨windowså¼€å‘é‡åˆ°ç¼–è¯‘æŠ¥é”™åŸå› æ˜¯ç¼–è¯‘çš„æ—¶å€™å°ç¨‹åºå¼€å‘å·¥å…·ä¹Ÿåœ¨åŒæ—¶ç¼–è¯‘æ”¹åŠ¨æ–‡ä»¶å¯¼è‡´æ–‡ä»¶æ— æ³•è¦†ç›–å’Œä¿å­˜ã€‚

å› æ­¤ï¼Œé€€ä¸€æ­¥åœ¨åŸç”ŸåŸºç¡€ä¸Šæä¸€å¥—æ¡†æ¶å‡ºæ¥ï¼Œè¿™å¥—æ¡†æ¶æ˜¯æ— æ„ŸçŸ¥ã€æ¸è¿›å¢å¼ºæ¡†æ¶ï¼Œåœ¨ä¿ç•™åŸæ¥å†™æ³•ä¸Šæ–°å¢è¯­æ³•æ–¹æ³•å’Œç‰¹æ€§ï¼ŒåŒ…å®¹åŸç”Ÿé¡µé¢ç»„ä»¶ç”Ÿæ€ï¼Œåœ¨æ–°é¡¹ç›®ä½¿ç”¨æ¡†æ¶å¯ä»¥å¼•å…¥ä¹‹å‰åŸç”Ÿå†™çš„ç»„ä»¶ï¼ŒåŒæ—¶ä»¥å‰çš„ç»´æŠ¤é¡¹ç›®å¯ä»¥æ— ç¼å¼•å…¥æ¡†æ¶ã€‚

## å®‰è£… ##

`npm i miniapp-spore -s`

## åˆå§‹åŒ– ##

`app.js`æ–‡ä»¶å¤´éƒ¨ä½ éœ€è¦åŠ è¿™ä¸¤è¡Œä»£ç ï¼Œæ¡†æ¶å°±å¼€å§‹è¿ä½œäº†
```javascript
import app from "./npm/app";
let apis = app({
    env:'test'
});
```
ä¸‹é¢æ˜¯å®Œæ•´çš„app.jsæ–‡ä»¶ç¤ºä¾‹

```javascript
import app from "./npm/app";
let apis = app({//config
  env:"test",    //å½“å‰ç¯å¢ƒ test | online ï¼Œåˆ‡æ¢ç¯å¢ƒè¿™ä¸ªå­—æ®µå¿…æ”¹ï¼Œ
  envs:{
    //æ ¹æ®ä¸Šé¢envåˆ¤æ–­å¯¹åº”é…ç½®ï¼Œå¹¶æ·±åº¦åˆå¹¶åˆ°config
    "test":{
        //æµ‹è¯•ç¯å¢ƒçš„é…ç½®
        appUrl:"https://m.duanqu.com?_ariver_appid=3000000003651171&nbsv=0.1.2004151741.2&nbsource=debug&nbsn=DEBUG",
    },
    "online":{
        //æ­£å¼ç¯å¢ƒçš„é…ç½®
        appUrl:"https://m.duanqu.com?_ariver_appid=3000000003651171"
    }
  },
  debug: false,//æ˜¯å¦å¼€å¯æ¡†æ¶å†…çš„logè°ƒè¯•ä¿¡æ¯
  //å…¶å®ƒé…ç½®ä¿¡æ¯
  shop:{
    shopId: "106564654",
    sellerId:"1818112088",
  },
});

//apis æ˜¯åœ¨ npm/apis.js ä¸­é…ç½®çš„æ¥å£å‡½æ•°é‡Œé¢æœ‰ äº‘å‡½æ•° å’Œ å·¥å…·å‡½æ•°
// apis.config ä¸ºé…ç½®ä¿¡æ¯ï¼ˆæ ¹æ®ç¯å¢ƒä¼šè‡ªåŠ¨åˆ‡æ¢ï¼‰
// äº‘å‡½æ•°ä¹Ÿä¼šæ ¹æ®ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ 
//apiså¯ä»¥æ”¾å…¥åˆ°Appé…ç½®ä¸­å¦‚ï¼š
App({
  apis,//é¡µé¢å’Œç»„ä»¶ å¯ä»¥è·å–  let apis = getApp().apis;
  onLaunch(options) {
  },
  onShow(options) {
  },
  //...
});
```


## ç‰¹æ€§ ##
é¡µé¢å’Œç»„ä»¶æ”¯æŒdataé…ç½®è®¡ç®—æ–¹æ³•

```javascript
Page({
    data:{
        numA: 5,
        numB: 3,
        count(){    //æ”¯æŒè®¡ç®—æ–¹æ³•
            return this.numA + this.numB;
        }
    }
});
//numA numB å€¼æ›´æ–°ï¼Œå¯¹åº”countè‡ªåŠ¨è®¡ç®—æ›´æ–°
```
```xml
<view>{{count}}</view>
<!-- 8 -->
```



## é¡µé¢é…ç½® ##

### è‡ªåŠ¨æ³¨å…¥ `injections :Array String` ###
å°†pageé¡µé¢å®ä¾‹ä¸­çš„æ–¹æ³•è‡ªåŠ¨æ³¨å…¥åˆ°ç»„ä»¶ä¸­

```javascript
Page({
    injections:["pagefn"],
    pagefn(){
        console.log('è¿™æ˜¯é¡µé¢çš„ä¸€ä¸ªæ–¹æ³•')
    }
});
```
æ­¤æ—¶ï¼Œåœ¨ç»„ä»¶ä¸­å°±å¯ä»¥ç›´æ¥è°ƒç”¨pagefnæ–¹æ³•äº†(åªè¦é¡µé¢å¼•å…¥äº†è¿™ä¸ªç»„ä»¶å°±æœ‰pagefnæ–¹æ³•)
```javascript
Component({
  didMount() {
      //å¯ä»¥ç›´æ¥è°ƒç”¨pagefnæ–¹æ³•
      this.pagefn();
  }
});
```


#### æ–¹æ³•é˜²æŠ– `throttle :Object` ####
`{æ–¹æ³•å:æ¯«ç§’æ•°}`
é…ç½®é¡µé¢ä¸­å¯¹åº”æ–¹æ³•è½¬åŒ–ä¸ºé˜²æŠ–æ–¹æ³•ï¼Œç›¸å…³é˜²æŠ–æœºåˆ¶è¯·ç™¾åº¦
```javascript
Page({
    throttle:{
        onClick:3000
    },
    onClick(){
        console.log('è¿™ä¸ªæ–¹æ³•å·²åšé˜²æŠ–å¤„ç†ï¼Œ3ç§’å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡ï¼Œä½ å†æ€ä¹ˆç–¯ç‹‚ç‚¹å‡»æ²¡æœ‰ç”¨çš„ğŸ˜‚')
    }
});
```



## é¡µé¢å®ä¾‹ pageInstance ##

é¡µé¢å®ä¾‹æŒ‡çš„æ˜¯åœ¨é¡µé¢æ–¹æ³•å†…çš„thiså®ä¾‹ã€‚


### `pageInstance.update(data, callback)` ###
æ›´æ–°dataæ•°æ®ã€‚
é¦–å…ˆï¼Œæ–¹æ³•æ€§èƒ½ä¼˜åŒ–ç‰ˆçš„åŸç”ŸsetDataï¼Œä½œä¸ºåŸç”ŸsetDataçš„æ›¿ä»£æ–¹æ¡ˆã€‚å…¶æ¬¡æä¾›äº†ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œç”¨æ›´å®¹æ˜“ç†è§£çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚

æ–¹å¼ä¸€ï¼Œç›´æ¥ä¿®æ”¹dataï¼Œæœ€åupdateï¼š
```javascript
this.data.language = 'zh_cn'
this.data.userName = 'é»‘åŒ–è‚¥å‘ç°'
this.data.userList[0].name = 'å¼ ä¸‰ç–¯'
this.update() //ä¸è¦å¿˜è®°æ‰§è¡Œupdateæ–¹æ³•
```
æ–¹å¼äºŒï¼ŒåŸç”Ÿæ–¹å¼ï¼š
```javascript
this.update({
    foo: 1,
    style: {
        color:'red'
    }
})
```

æ€§èƒ½è‡ªåŠ¨ä¼˜åŒ–ï¼š
```javascript
Component({
  data: {
      arr: [0, 1],
      a:{
          b:'b',
          c:'c',
          d:{
              e:'e',
              f:'f'
          }
      }
  },
  didMount() {
      this.data.a.d.f = 'boom';
      this.update({
          arr:[0, 1, 2],
      });

    // åœ¨updateæ–¹æ³•å†…éƒ¨ä¼˜åŒ–åè°ƒç”¨setDataç›¸å½“äº 
    // this.setData({
    //     'a.d.f': "boom", 
    //     'arr[2]': 2   //è¿™é‡Œåªåšäº†æœ€å°åŒ–æ›´æ–°ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ•°ç»„è¿›è¡Œæ›´æ–°
    // })
  }
});
```
æ€§èƒ½ä¼˜åŒ–çš„åŸç†
```
 ---------------       -------------------        -----------------------
| this.update  |  â†’  |     json diff     |   â†’  | setData()-setData()...|  â†’  æ¸²æŸ“
 ---------------       -------------------        -----------------------
```


æ³¨æ„ï¼šä¸€æ—¦ä½ å‡†å¤‡åœ¨ä¸€ä¸ªé¡µé¢æˆ–è€…ç»„ä»¶ä¸­ä½¿ç”¨updateæ–¹æ³•ï¼Œè¯·ä¸è¦ä½¿ç”¨setData $spliceDataæ–¹æ³• !!!

### `pageInstance.$splice(data, callback)` ###

åœ¨é¡¹ç›®ä¸­ï¼Œå› ä¸ºä½¿ç”¨äº†updateï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨\$spliceDataï¼Œè¿™é‡Œçš„æ›¿ä»£æ–¹æ³•ç”¨æ³•ä¸€è‡´ï¼Œç”¨æ³•å‚è€ƒ\$spliceDataæ–¹æ³•

### `pageInstance.linkData(e)` ###
ç®€æ˜“åŒå‘ç»‘å®šï¼Œä¸»è¦ç”¨äºè¡¨å•ï¼Œç”¨æˆ·è§¦å‘äº‹ä»¶è‡ªåŠ¨æ›´æ–°dataæ•°æ®ã€‚

```javascript
Page({
    data:{
        input:'foo'
    }
});
```
```xml
<view>
  <view>ä½ è¾“å…¥çš„æ˜¯ï¼š{{input}}</view>
  <input onBlur="linkData" onInput="linkData" data-linkkey="input" value="{{input}}">
</view>
```
æ³¨æ„ï¼šä¸è¦ä¸»åŠ¨å»è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä»…ç”¨äºæ¨¡æ¿å†…äº‹ä»¶ç»‘å®šã€‚


## ç»„ä»¶é…ç½® ##

### æ–¹æ³•é˜²æŠ– `throttle :Object` ###
é…ç½®ç»„ä»¶ä¸­å¯¹åº”æ–¹æ³•è½¬åŒ–ä¸ºé˜²æŠ–æ–¹æ³•ï¼Œç›¸å…³é˜²æŠ–æœºåˆ¶è¯·ç™¾åº¦

## ç»„ä»¶å®ä¾‹ `componentInstance` (åœ¨ç»„ä»¶æ–¹æ³•å†…çš„this) ##


### `componentInstance.update(data, callback)` ###
æ›´æ–°ç»„ä»¶çš„dataæ•°æ®ï¼Œç”¨æ³•å‚è€ƒé¡µé¢çš„update

### `componentInstance.$splice(data, callback)` ###
ç”¨æ³•å‚è€ƒé¡µé¢çš„$splice

### `componentInstance.updatePage(data, callback)` ###
åœ¨ç»„ä»¶å†…æ›´æ–°é¡µé¢dataæ•°æ®ï¼Œç›¸å½“äºé¡µé¢updateåˆ«åæ–¹æ³•å‚è€ƒé¡µé¢update

### `componentInstance.linkData(e)` ###

ç”¨æ³•å‚è€ƒé¡µé¢çš„linkData


## æ¥å£äº‘å‡½æ•°åº“apis.js ##

**æ ¹æ®æ¯ä¸ªé¡¹ç›®äº‘å‡½æ•°ï¼Œè‡ªè¡Œåœ¨apis.jså†…ä¿®æ”¹æ·»åŠ å‡½æ•°é…ç½®ä¿¡æ¯ï¼Œåœ¨é¡µé¢å’Œç»„ä»¶å†…è°ƒç”¨**

æ ¹æ®å‰é¢åœ¨Appåˆå§‹åŒ–åï¼Œé¡µé¢å’Œç»„ä»¶å¯ä»¥è·å–åˆ°apisï¼Œ
apiså†…æœ‰å¸¸ç”¨çš„å°è£…å¥½çš„å·¥å…·å‡½æ•°ï¼Œä¹Ÿæœ‰éœ€è¦æå‰è‡ªè¡Œé…ç½®å¥½çš„äº‘å‡½æ•°ã€‚

```javascript
let apis = getApp().apis;

//æ¯”å¦‚:

//å·¥å…·å‡½æ•°ï¼Œæ”¯æŒè·³è½¬å¤–é“¾/é¡µé¢
apis.jump('https://m.taobao.com');

//è°ƒç”¨apiså†…é…ç½®å¥½çš„äº‘å‡½æ•°ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†å¥½å‚æ•°å’Œè¿”å›å€¼ï¼Œé¡µé¢ç»„ä»¶é‡ç”¨
let data = await apis.enter();

//ç›´æ¥è°ƒç”¨äº‘å‡½æ•° `äº‘å‡½æ•°.å‡½æ•°å` æäº¤æ•°æ®
let res = await apis.f('user.enter', {foo:'bar'})
//ç­‰åŒäº cloud.function.invoke('user', {foo:'bar'}, 'enter');

```



## æ¨¡æ¿JSå·¥å…·å‡½æ•° tpl-utils.sjs ##
ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨axmlæ¨¡æ¿ä¸­å°†å…¶æ–‡ä»¶å¼•å…¥ï¼š
```xml
<!-- å¼•å…¥å·¥å…·å‡½æ•° -->
<import-sjs name="util" from="../../npm/tpl-utils.sjs"></import-sjs>

<!-- ä¹‹åä½ å°±å¯ä»¥è°ƒç”¨utilså†…éƒ¨æ–¹æ³• -->
{{util.json(foo)}}

```
å…·ä½“æœ‰å“ªäº›å‡½æ•°ï¼Œçœ‹æºç å§ğŸ™‚

## viewsè§†å›¾å†å²ç»„ä»¶ ##

ä½ç½®åœ¨ `npm/views` é‡Œé¢æœ‰æ–‡æ¡£


